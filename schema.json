{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://logline.world/schemas/minitradutor.translation_contract.json",
  "title": "MinitradutorTranslationContractEnvelope",
  "type": "object",
  "additionalProperties": false,
  "required": ["contract"],
  "properties": {
    "contract": {
      "type": "object",
      "title": "TranslationContract",
      "additionalProperties": false,
      "required": [
        "id",
        "workflow",
        "flow",
        "source_language",
        "target_language",
        "source_text",
        "translated_text",
        "method",
        "confidence",
        "provenance"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique contract id, e.g. trans_<hash>."
        },
        "workflow": {
          "type": "string",
          "description": "High-level workflow name, e.g. docgen."
        },
        "flow": {
          "type": "string",
          "description": "More specific flow name, e.g. translate_fn."
        },
        "source_language": {
          "type": "string",
          "description": "Source language (ISO639-1/3 or technical tag like 'python').",
          "minLength": 1
        },
        "target_language": {
          "type": "string",
          "description": "Target language (ISO639-1/3 or technical tag).",
          "minLength": 1
        },
        "source_text": {
          "type": "string",
          "description": "Original text to be translated."
        },
        "translated_text": {
          "type": "string",
          "description": "Translated text produced by provider."
        },
        "translator": {
          "type": "string",
          "description": "Translator identifier (human, model, or hybrid)."
        },
        "method": {
          "type": "string",
          "enum": ["human", "machine", "hybrid"],
          "description": "Translation method."
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Confidence score between 0.0 and 1.0."
        },
        "provenance": {
          "type": "object",
          "title": "ProvenanceBlock",
          "additionalProperties": false,
          "required": ["timestamp", "tenant_id", "signature"],
          "properties": {
            "timestamp": {
              "type": "string",
              "format": "date-time",
              "description": "ISO8601 UTC timestamp."
            },
            "tenant_id": {
              "type": "string",
              "minLength": 1,
              "description": "Tenant identifier (e.g. 'voulezvous')."
            },
            "signature": {
              "type": "string",
              "description": "Hex-encoded signature or empty string if signing disabled."
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "method": {
                "enum": ["human", "hybrid"]
              }
            }
          },
          "then": {
            "required": ["translator"]
          }
        }
      ]
    }
  }
}
